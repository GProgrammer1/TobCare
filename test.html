<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Picker</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
</head>
<body>
    <!-- Input fields for Latitude and Longitude -->
    <div>
        <label for="latitude">Latitude:</label>
        <input type="text" id="latitude" readonly><br><br>
        
        <label for="longitude">Longitude:</label>
        <input type="text" id="longitude" readonly><br><br>
    </div>

    <!-- Map -->
    <div id="map" style="height: 400px; width: 100%;"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

    <script>
      // Initialize map and create marker (with a default fallback location)
      var map = L.map('map');
      var marker = L.marker([51.505, -0.09]).addTo(map);  // Default marker location

      // Set the initial map view to a default location (fallback location)
      map.setView([51.505, -0.09], 13);  // Default location (lat, lng)

      // Add tile layer from OpenStreetMap
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      // Attempt to get the user's current location using Geolocation API
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(function(position) {
          var lat = position.coords.latitude;
          var lng = position.coords.longitude;

          // Update the map and marker to user's current location
          map.setView([lat, lng], 13);  // Zoom level 13 for better detail
          marker.setLatLng([lat, lng]);  // Move marker to the current location

          // Update latitude and longitude inputs with current location
          document.getElementById('latitude').value = lat;
          document.getElementById('longitude').value = lng;

          // Optionally, bind a popup with the coordinates
          marker.bindPopup("<b>Latitude: </b>" + lat + "<br><b>Longitude: </b>" + lng).openPopup();
        }, function(error) {
          alert("Geolocation failed. Using default location.");
        });
      } else {
        alert("Geolocation is not supported by your browser.");
      }

      // Update the input fields when the user clicks on the map
      map.on('click', function(e) {
        var lat = e.latlng.lat;
        var lng = e.latlng.lng;

        // Update latitude and longitude input fields
        document.getElementById('latitude').value = lat;
        document.getElementById('longitude').value = lng;

        // Update marker position
        marker.setLatLng([lat, lng]);

        // Optionally, bind a popup with the coordinates
        marker.bindPopup("<b>Latitude: </b>" + lat + "<br><b>Longitude: </b>" + lng).openPopup();
      });
    </script>
</body>
</html>
